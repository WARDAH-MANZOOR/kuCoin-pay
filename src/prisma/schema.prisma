generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Order {
  id            String   @id @default(uuid())
  requestId     String   @unique
  orderAmount   Float
  orderCurrency String
  reference     String?
  subMerchantId String?
  source        String?
  expireTime    Int?
  kucoinOrderId String?  @unique
  qrcodeUrl     String?
  appPayUrl     String?
  status        String   @default("PENDING")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  refunds       Refund[]
}

model Refund {
  id              String   @id @default(uuid())
  refundRequestId String   @unique
  payOrderId      String
  refundAmount    Float
  refundReason    String?
  status          String   @default("PENDING")
  kucoinRefundId  String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // ðŸ‘‡ Relation to Order
  order           Order?   @relation(fields: [payOrderId], references: [kucoinOrderId])
}

model Report {
  id          String   @id @default(uuid())
  reportType  String
  fileName    String?
  reportDate  String
  downloadUrl String?
  status      String
  createdAt   DateTime @default(now())

  @@unique([reportType, reportDate]) // âœ… Enforce uniqueness per report type and date
}

model Payout {
  id           String   @id @default(uuid())
  requestId    String   @unique                    // Merchantâ€™s payout request ID
  batchNo      String?                            // KuCoin Pay batch number
  payoutType   String                             // onChain or offChain
  batchName    String                             // Batch name
  currency     String                             // e.g., USDT
  chain        String?                            // e.g., TRON, ETH
  totalAmount  Float                              // Total payout amount
  totalCount   Int                                // Total number of payout details
  status       String   @default("PENDING")       // SUCCESS / FAILED / PENDING
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // ðŸ‘‡ Relation: one payout â†’ many payout details
  details      PayoutDetail[]
}

model PayoutDetail {
  id              String   @id @default(uuid())
  detailId        String   @unique                // Merchantâ€™s detail identifier
  receiverUID     String?                         // KuCoin UID if off-chain
  receiverAddress String?                         // Wallet address if on-chain
  amount          Float
  remark          String?
  status          String   @default("PENDING")    // SUCCESS / FAILED / PENDING
  payoutId        String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // ðŸ‘‡ Relation: each detail belongs to one payout
  payout          Payout   @relation(fields: [payoutId], references: [id])
}
