generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
model Order {
  id            String   @id @default(uuid())
  requestId     String   @unique
  orderAmount   Float
  orderCurrency String
  reference     String?
  subMerchantId String?
  source        String?
  expireTime    Int?
  kucoinOrderId String?  @unique   // âœ… add @unique here
  qrcodeUrl     String?
  appPayUrl     String?
  status        String   @default("PENDING")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  refunds       Refund[]
}


model Refund {
  id              String   @id @default(uuid())
  refundRequestId String   @unique
  payOrderId      String
  refundAmount    Float
  refundReason    String?
  status          String   @default("PENDING")
  kucoinRefundId  String?  // from KuCoin API response (refundId)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // ðŸ‘‡ Relation to Order
  order           Order?   @relation(fields: [payOrderId], references: [kucoinOrderId])
}
model Report {
  id          String   @id @default(uuid())
  reportType  String
  fileName    String?
  reportDate  String
  downloadUrl String?
  status      String
  createdAt   DateTime @default(now())

  @@unique([reportType, reportDate]) // âœ… enforce one record per date+type
}

model WebhookLog {
  id          String   @id @default(uuid())
  eventType   String
  payload     Json
  signature   String?
  verified    Boolean  @default(false)
  receivedAt  DateTime @default(now())
}
